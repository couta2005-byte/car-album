<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Car Album</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>

<header class="header">
  <div class="header-inner">
    <a href="/" class="logo">Car Album</a>

    <nav class="nav">
      <a href="/" class="nav-link {% if mode=='home' %}active{% endif %}">ãŠã™ã™ã‚</a>

      {% if user %}
        <a href="/following" class="nav-link {% if mode=='following' %}active{% endif %}">ãƒ•ã‚©ãƒ­ãƒ¼ä¸­</a>
      {% endif %}

      <a href="/ranking?period=day" class="nav-link {% if mode=='ranking_day' or mode=='ranking_week' or mode=='ranking_month' %}active{% endif %}">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>

      {% if user %}
        <a href="/user/{{ user }}" class="nav-link">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
        <form action="/logout" method="post" class="logout-form">
          <button class="logout-btn" type="submit">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </form>
      {% endif %}
    </nav>
  </div>
</header>

<main class="container">

{% if mode=='ranking_day' or mode=='ranking_week' or mode=='ranking_month' %}
<div class="ranking-tabs">
  <a href="/ranking?period=day" class="{% if mode=='ranking_day' %}active{% endif %}">æ—¥</a>
  <a href="/ranking?period=week" class="{% if mode=='ranking_week' %}active{% endif %}">é€±</a>
  <a href="/ranking?period=month" class="{% if mode=='ranking_month' %}active{% endif %}">æœˆ</a>
</div>
{% endif %}

{% if ranking_title %}
<h2 class="page-title">{{ ranking_title }}</h2>
{% endif %}

<form method="get" class="card search-form">
  <div class="grid-3">
    <input name="maker" placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼" value="{{ maker }}">
    <input name="car" placeholder="è»Šç¨®" value="{{ car }}">
    <input name="region" placeholder="åœ°åŸŸ" value="{{ region }}">
  </div>
  <button class="primary-btn" type="submit">æ¤œç´¢</button>
</form>

{% if not user %}
<div class="grid-2">
  <div class="card">
    <h3 class="card-title">ãƒ­ã‚°ã‚¤ãƒ³</h3>
    <form action="/login" method="post">
      <input name="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
      <input name="password" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
      <button class="primary-btn" type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </form>
  </div>

  <div class="card">
    <h3 class="card-title">æ–°è¦ç™»éŒ²</h3>
    <form action="/register" method="post">
      <input name="username" placeholder="æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
      <input name="password" type="password" placeholder="æ–°è¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
      <button class="primary-btn" type="submit">æ–°è¦ç™»éŒ²</button>
    </form>
  </div>
</div>
{% else %}

{% if mode=="home" %}
<div class="card">
  <h3 class="card-title">æŠ•ç¨¿</h3>
  <form action="/post" method="post" enctype="multipart/form-data">
    <div class="grid-3">
      <input name="maker" placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼">
      <input name="region" placeholder="åœ°åŸŸ">
      <input name="car" placeholder="è»Šå">
    </div>
    <textarea name="comment" placeholder="ã²ã¨ã“ã¨"></textarea>
    <input type="file" name="image">
    <button class="primary-btn" type="submit">æŠ•ç¨¿</button>
  </form>
</div>
{% endif %}
{% endif %}

<div class="posts">
{% for post in posts %}
  <article class="post-card">
    <div class="post-top">
      <a class="post-user" href="/user/{{ post.username }}">{{ post.username }}</a>
      <div class="post-meta">
        <span class="post-date">{{ post.created_at }}</span>
      </div>
    </div>

    <div class="post-car">{{ post.car }}</div>

    {% if post.comment %}
      <div class="post-text">{{ post.comment }}</div>
    {% endif %}

    {% if post.image %}
      <img src="{{ post.image }}" class="post-image">
    {% endif %}

    <div class="post-actions">
      <form method="post" action="{% if post.id in liked_posts %}/unlike/{{ post.id }}{% else %}/like/{{ post.id }}{% endif %}">
        <button class="like-btn" type="submit">
          {% if post.id in liked_posts %}â¤ï¸{% else %}ğŸ¤{% endif %} {{ post.likes }}
        </button>
      </form>

      {% if user and user == post.username %}
      <form method="post" action="/delete/{{ post.id }}" onsubmit="return confirm('ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
        <button class="delete-btn" type="submit">å‰Šé™¤</button>
      </form>
      {% endif %}
    </div>

    {% if post.comments %}
    <div class="comments">
      {% for c in post.comments %}
        <div class="comment"><b>{{ c[1] }}</b> {{ c[2] }}</div>
      {% endfor %}
    </div>
    {% endif %}

    {% if user %}
    <form action="/comment/{{ post.id }}" method="post" class="comment-form">
      <input name="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã">
      <button class="secondary-btn" type="submit">é€ä¿¡</button>
    </form>
    {% endif %}
  </article>
{% endfor %}
</div>

</main>
</body>
</html>
