<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>{{ username }} | Carbum</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css?v=14">
</head>
<body>

{% include "_nav.html" %}

<main class="container">

  <div class="profile-header" style="display:flex; justify-content:space-between; align-items:center; gap:12px;">

    <div style="display:flex; align-items:center; gap:12px;">
      {% if profile and profile[4] %}
        <div class="avatar"><img src="{{ profile[4] }}"></div>
      {% else %}
        <span class="avatar-fallback"></span>
      {% endif %}
      <div>
        <h2>{{ display_name if display_name else username }}</h2>
        <div style="color:#536471;">@{{ handle if handle else username }}</div>
      </div>
    </div>

    {% if me_user_id and target_user_id and me_user_id != target_user_id %}
      <div style="display:flex; gap:8px;">
        {% if is_following %}
          <form action="/unfollow/{{ (handle if handle else username) | urlencode }}" method="post">
            <button class="follow-btn">フォロー解除</button>
          </form>
        {% else %}
          <form action="/follow/{{ (handle if handle else username) | urlencode }}" method="post">
            <button class="follow-btn">フォローする</button>
          </form>
        {% endif %}

        <!-- ✅ DM Button -->
        <a href="/dm/start/{{ target_user_id }}" class="follow-btn">
          DMする
        </a>
      </div>
    {% endif %}
  </div>

</main>
</body>
</html>
