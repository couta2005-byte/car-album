<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æŠ•ç¨¿è©³ç´° | Carbum</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

{% include "_nav.html" %}

<main class="container">

  <a href="javascript:history.back()" class="back-link">â† æˆ»ã‚‹</a>

  <!-- æŠ•ç¨¿æœ¬ä½“ -->
  <article class="post">

    <div class="post-top">
      <a href="/user/{{ post.username | urlencode }}" class="post-user">
        {{ post.username }}
      </a>
      <span class="post-date">{{ post.created_at }}</span>
    </div>

    <div class="post-car">{{ post.car }}</div>

    {% if post.comment %}
      <div class="post-comment">{{ post.comment }}</div>
    {% endif %}

    {% if post.image %}
      <div class="post-image">
        <img src="{{ post.image }}" alt="æŠ•ç¨¿ç”»åƒ">
      </div>
    {% endif %}

    <div class="post-actions">
      {% if user %}
        {% if post.id in liked_posts %}
          <form action="/unlike/{{ post.id }}" method="post">
            <button type="submit" class="like-btn">â¤ï¸ {{ post.likes }}</button>
          </form>
        {% else %}
          <form action="/like/{{ post.id }}" method="post">
            <button type="submit" class="like-btn">ğŸ¤ {{ post.likes }}</button>
          </form>
        {% endif %}
      {% else %}
        <span>ğŸ¤ {{ post.likes }}</span>
      {% endif %}

      {% if user == post.username %}
        <form action="/delete/{{ post.id }}" method="post"
              onsubmit="return confirm('ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
          <button type="submit" class="delete-btn">ğŸ—‘ å‰Šé™¤</button>
        </form>
      {% endif %}
    </div>

  </article>

  <!-- ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ -->
  <section class="comments">

    <h3 class="comments-title">
      ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ{{ post.comments | length }}ï¼‰
    </h3>

    {% if post.comments %}
      <ul class="comment-list">
        {% for c in post.comments %}
          <li class="comment-item">
            <div class="comment-top">
              <a href="/user/{{ c[1] | urlencode }}" class="comment-user">
                {{ c[1] }}
              </a>
              <span class="comment-date">
                {{ (c[3] + timedelta(hours=9)).strftime("%Y-%m-%d %H:%M") if c[3] }}
              </span>
            </div>
            <div class="comment-body">
              {{ c[2] }}
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="no-comment">ã¾ã ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
    {% endif %}

    {% if user %}
      <form action="/comment/{{ post.id }}" method="post" class="comment-form">
        <textarea name="comment" rows="3" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ãâ€¦" required></textarea>
        <button type="submit">é€ä¿¡</button>
      </form>
    {% else %}
      <p class="login-note">
        ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ã«ã¯ <a href="/login">ãƒ­ã‚°ã‚¤ãƒ³</a> ãŒå¿…è¦ã§ã™
      </p>
    {% endif %}

  </section>

</main>

</body>
</html>
