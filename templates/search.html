<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ¤œç´¢ | Carbum</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css?v=10">
</head>
<body>

{% include "_nav.html" %}

<main class="container">

  <!-- ===== Search Header ===== -->
  <section class="search-hero">
    <h1 class="search-title">æ¤œç´¢</h1>

    <!-- âœ… çµã‚Šè¾¼ã¿ã ã‘æ®‹ã™ï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»è»Šåãƒ»åœ°åŸŸï¼‰ -->
    <form action="/search" method="get" class="search-advanced-form">
      <div class="search-grid">
        <input class="search-input" type="text" name="maker" placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆä¾‹ï¼šãƒˆãƒ¨ã‚¿ï¼‰" value="{{ maker }}">
        <input class="search-input" type="text" name="car" placeholder="è»Šåï¼ˆä¾‹ï¼šãƒãƒ¼ã‚¯Xï¼‰" value="{{ car }}">
        <input class="search-input" type="text" name="region" placeholder="åœ°åŸŸï¼ˆä¾‹ï¼šæ—­å·ï¼‰" value="{{ region }}">
      </div>
      <button class="search-btn" type="submit">çµã‚Šè¾¼ã‚€</button>
    </form>

    {% if maker or car or region %}
      <p class="search-meta">
        çµã‚Šè¾¼ã¿ä¸­ï¼š
        {% if maker %}<span class="tag">ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼š{{ maker }}</span>{% endif %}
        {% if car %}<span class="tag">è»Šåï¼š{{ car }}</span>{% endif %}
        {% if region %}<span class="tag">åœ°åŸŸï¼š{{ region }}</span>{% endif %}
      </p>
    {% else %}
      <p class="search-meta">ãƒ¡ãƒ¼ã‚«ãƒ¼ / è»Šå / åœ°åŸŸ ã‚’å…¥ã‚Œã¦çµã‚Šè¾¼ã‚“ã§ã­</p>
    {% endif %}
  </section>

  <!-- ===== Posts ===== -->
  <section class="search-section">
    <h2 class="section-title">æŠ•ç¨¿{% if posts %}ï¼ˆ{{ posts|length }}ä»¶ï¼‰{% endif %}</h2>

    {% if maker or car or region %}
      {% if posts and posts|length > 0 %}
        <div class="posts">
        {% for post in posts %}
          <article class="post"
                   role="link"
                   tabindex="0"
                   onclick="location.href='/post/{{ post.id }}';"
                   onkeydown="if(event.key==='Enter' || event.key===' '){ location.href='/post/{{ post.id }}'; }"
                   style="position:relative;">

            <div class="post-top">
              <div class="post-title">

                {% if post.user_icon %}
                  <div class="avatar" onclick="event.stopPropagation();" style="position:relative; z-index:2;">
                    <a href="/user/{{ post.username | urlencode }}" onclick="event.stopPropagation();">
                      <img src="{{ post.user_icon }}" alt="icon">
                    </a>
                  </div>
                {% else %}
                  <a href="/user/{{ post.username | urlencode }}"
                     onclick="event.stopPropagation();"
                     style="position:relative; z-index:2; display:inline-block;">
                    <span class="avatar-fallback"></span>
                  </a>
                {% endif %}

                <div class="post-title-main">
                  <a href="/user/{{ post.username | urlencode }}"
                     class="post-user"
                     style="position:relative; z-index:2;"
                     onclick="event.stopPropagation();">
                    {{ post.username }}
                  </a>
                  <span class="post-sep">ï¼š</span>
                  <span class="post-car">{{ post.car }}</span>
                </div>
              </div>

              <span class="post-date">{{ post.created_at }}</span>
            </div>

            {% if post.comment %}
              <div class="post-comment">{{ post.comment }}</div>
            {% endif %}

            {% if post.image %}
              <div class="post-image">
                <img src="{{ post.image }}" alt="æŠ•ç¨¿ç”»åƒ">
              </div>
            {% endif %}

            <!-- âœ… ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼šå‰Šé™¤ â†’ ã‚³ãƒ¡ãƒ³ãƒˆ â†’ ã„ã„ã­ï¼ˆå³å¯„ã›ï¼‰ -->
            <div class="post-actions" style="position:relative; z-index:2;" onclick="event.stopPropagation();">
              <div class="post-actions-right">

                <!-- å‰Šé™¤ï¼ˆè‡ªåˆ†ã ã‘ï¼‰ -->
                {% if user and user == post.username %}
                  <form action="/delete/{{ post.id }}" method="post" onsubmit="event.stopPropagation();">
                    <button class="delete-btn" type="submit" onclick="event.stopPropagation();">ğŸ—‘ å‰Šé™¤</button>
                  </form>
                {% endif %}

                <!-- ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆè©³ç´°ã¸ï¼‰ -->
                <a href="/post/{{ post.id }}#comments"
                   class="action-btn"
                   onclick="event.stopPropagation();">
                  <span>ğŸ’¬</span>
                  <span class="count">{{ post.comment_count }}</span>
                </a>

                <!-- ã„ã„ã­ -->
                {% if user %}
                  <button type="button"
                          class="like-btn js-like {% if post.id in liked_posts %}active{% endif %}"
                          data-post-id="{{ post.id }}"
                          data-liked="{% if post.id in liked_posts %}1{% else %}0{% endif %}"
                          aria-pressed="{% if post.id in liked_posts %}true{% else %}false{% endif %}">
                    <span class="like-icon">{% if post.id in liked_posts %}â¤ï¸{% else %}ğŸ¤{% endif %}</span>
                    <span class="like-count">{{ post.likes }}</span>
                  </button>
                {% else %}
                  <span>ğŸ¤ {{ post.likes }}</span>
                {% endif %}

              </div>
            </div>

          </article>
        {% endfor %}
        </div>
      {% else %}
        <p class="empty-note">è©²å½“æŠ•ç¨¿ãªã—</p>
      {% endif %}
    {% else %}
      <p class="empty-note">ä¸Šã®å…¥åŠ›æ¬„ã§çµã‚Šè¾¼ã¿æ¡ä»¶ã‚’å…¥ã‚Œã¦ã­</p>
    {% endif %}
  </section>

</main>

</body>
</html>
