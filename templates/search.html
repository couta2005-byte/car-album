<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ¤œç´¢ | Carbum</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- â˜…å…¨ãƒšãƒ¼ã‚¸ã§åŒã˜vã«ã™ã‚‹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°ï¼‰ -->
  <link rel="stylesheet" href="/static/style.css?v=10">
</head>
<body>

{% include "_nav.html" %}

<main class="container">

  <!-- ===== Search Header ===== -->
  <section class="search-hero">
    <h1 class="search-title">æ¤œç´¢</h1>

    <!-- âœ… çµã‚Šè¾¼ã¿ã ã‘æ®‹ã™ï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»è»Šåãƒ»åœ°åŸŸï¼‰ -->
    <form action="/search" method="get" class="search-advanced-form">
      <div class="search-grid">
        <input class="search-input" type="text" name="maker" placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆä¾‹ï¼šãƒˆãƒ¨ã‚¿ï¼‰" value="{{ maker }}">
        <input class="search-input" type="text" name="car" placeholder="è»Šåï¼ˆä¾‹ï¼šãƒãƒ¼ã‚¯Xï¼‰" value="{{ car }}">
        <input class="search-input" type="text" name="region" placeholder="åœ°åŸŸï¼ˆä¾‹ï¼šæ—­å·ï¼‰" value="{{ region }}">
      </div>
      <button class="search-btn" type="submit">çµã‚Šè¾¼ã‚€</button>
    </form>

    {% if maker or car or region %}
      <p class="search-meta">
        çµã‚Šè¾¼ã¿ä¸­ï¼š
        {% if maker %}<span class="tag">ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼š{{ maker }}</span>{% endif %}
        {% if car %}<span class="tag">è»Šåï¼š{{ car }}</span>{% endif %}
        {% if region %}<span class="tag">åœ°åŸŸï¼š{{ region }}</span>{% endif %}
      </p>
    {% else %}
      <p class="search-meta">ãƒ¡ãƒ¼ã‚«ãƒ¼ / è»Šå / åœ°åŸŸ ã‚’å…¥ã‚Œã¦çµã‚Šè¾¼ã‚“ã§ã­</p>
    {% endif %}
  </section>

  <!-- ===== Posts ===== -->
  <section class="search-section">
    <h2 class="section-title">æŠ•ç¨¿{% if posts %}ï¼ˆ{{ posts|length }}ä»¶ï¼‰{% endif %}</h2>

    {% if maker or car or region %}
      {% if posts and posts|length > 0 %}
        <div class="posts">
        {% for post in posts %}
          <article class="post"
                   role="link"
                   tabindex="0"
                   onclick="location.href='/post/{{ post.id }}';"
                   onkeydown="if(event.key==='Enter' || event.key===' '){ location.href='/post/{{ post.id }}'; }"
                   style="position:relative;">

            <div class="post-top">
              <div class="post-title">
                <a href="/user/{{ post.username | urlencode }}"
                   class="post-user"
                   style="position:relative; z-index:2;"
                   onclick="event.stopPropagation();">
                  {{ post.username }}
                </a>
                <span class="post-sep">ï¼š</span>
                <span class="post-car">{{ post.car }}</span>
              </div>
              <span class="post-date">{{ post.created_at }}</span>
            </div>

            {% if post.comment %}
              <div class="post-comment">{{ post.comment }}</div>
            {% endif %}

            {% if post.image %}
              <div class="post-image">
                <img src="{{ post.image }}" alt="æŠ•ç¨¿ç”»åƒ">
              </div>
            {% endif %}

            <!-- ã„ã„ã­ï¼šå…¨ãƒšãƒ¼ã‚¸å…±é€š like.js ãŒæ‹¾ã†æƒ³å®šï¼ˆjs-like + data-post-idï¼‰ -->
            <div class="post-actions" style="position:relative; z-index:2;" onclick="event.stopPropagation();">
              {% if user %}
                <button type="button"
                        class="like-btn js-like {% if post.id in liked_posts %}active{% endif %}"
                        data-post-id="{{ post.id }}"
                        data-liked="{% if post.id in liked_posts %}1{% else %}0{% endif %}"
                        aria-pressed="{% if post.id in liked_posts %}true{% else %}false{% endif %}">
                  <span class="like-icon">{% if post.id in liked_posts %}â¤ï¸{% else %}ğŸ¤{% endif %}</span>
                  <span class="like-count">{{ post.likes }}</span>
                </button>
              {% else %}
                <span>ğŸ¤ {{ post.likes }}</span>
              {% endif %}
            </div>

          </article>
        {% endfor %}
        </div>
      {% else %}
        <p class="empty-note">è©²å½“æŠ•ç¨¿ãªã—</p>
      {% endif %}
    {% else %}
      <p class="empty-note">ä¸Šã®å…¥åŠ›æ¬„ã§çµã‚Šè¾¼ã¿æ¡ä»¶ã‚’å…¥ã‚Œã¦ã­</p>
    {% endif %}
  </section>

</main>

</body>
</html>
