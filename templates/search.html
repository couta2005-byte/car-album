<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>検索 | Car Album</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>

{% include "_nav.html" %}

<main class="container">

  <h2 style="margin:12px 0 6px;">検索</h2>

  <!-- 検索フォーム（探す専用） -->
  <form action="/search" method="get" class="search-box">
    <input
      type="text"
      name="q"
      value="{{ q }}"
      placeholder="メーカー・車名・地域・アカウント名で検索"
    />
    <button type="submit">検索</button>
  </form>

  {% if q %}
    <div class="search-context">
      「<strong>{{ q }}</strong>」の検索結果
    </div>

    <!-- ===== アカウント ===== -->
    <div class="search-title">アカウント</div>

    {% if users and users|length > 0 %}
      <div class="search-chips">
        {% for u in users %}
          <a href="/user/{{ u | urlencode }}" class="chip">
            @{{ u }}
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="search-empty">該当アカウントなし</div>
    {% endif %}

    <!-- ===== 投稿 ===== -->
    <div class="search-title">
      投稿（{{ posts|length }}件）
    </div>

    {% if posts and posts|length > 0 %}
      {% for p in posts %}
        <article class="post">

          <div class="post-top">
            <div>
              <div class="post-car">
                {{ p.car or "" }}
                {% if p.maker %}<span>/ {{ p.maker }}</span>{% endif %}
                {% if p.region %}<span>/ {{ p.region }}</span>{% endif %}
              </div>

              <div class="post-sub">
                <a href="/user/{{ p.username | urlencode }}">
                  @{{ p.username }}
                </a>
                <span>・</span>
                <span>❤️ {{ p.likes }}</span>
              </div>
            </div>

            <div class="post-date">
              {{ p.created_at }}
            </div>
          </div>

          {% if p.comment %}
            <div class="post-comment">
              {{ p.comment }}
            </div>
          {% endif %}

          {% if p.image %}
            <div class="post-image">
              <img src="{{ p.image }}" alt="post image" />
            </div>
          {% endif %}

        </article>
      {% endfor %}
    {% else %}
      <div class="search-empty">
        該当する投稿がありません
      </div>
    {% endif %}

  {% else %}
    <div class="search-guide">
      上の入力欄にキーワードを入れて検索してね。
    </div>
  {% endif %}

</main>

</body>
</html>
